{
	admin unix/run/caddy-admin.sock

	auto_https off
	http_port 8080
	https_port 8443

	order cache before rewrite
	cache {
		allowed_http_verbs GET POST
		api {
			prometheus
		}
		cache_name Caddy
		ttl 10m
		default_cache_control public
	}
	log default {
		exclude http.handlers.cache
	}
}

localhost:8080 {
	@prod vars {env.PROD} true
	bind unix/run/server.sock tcp/localhost

	root * src/static
	try_files {path}.html {path} {path}/ =404
	file_server

	redir /blog/* https://blog.xtexx.eu.org/misc/migration-to-home/ permanent

	header Server xtex-home
	header Strict-Transport-Security "max-age=31536000";
	header Access-Control-Allow-Origin *;

	@templated path */ /*.html
	handle @templated {
		templates
		cache @prod {
			stale 24h
			ttl 10m
		}
	}
}
