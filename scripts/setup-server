#!/usr/bin/env bash

set -xet

# Update system
su -c "pacman -Sy archlinux-keyring; pacman -Syuu; pacman -S bash fish make coreutils busybox sudo"

# Configure system basics
sudo usermod -a -G root "$(whoami)"
[[ -e "/srv" ]] || sudo mkdir /srv

# Fetch atremis
cd /srv
sudo git clone --depth 1 --recurse-submodules --shallow-submodules --single-branch https://codeberg.org/xvnet/atremis.git
sudo chmod -R a+r atremis

sudo mkdir secrets
sudo chmod -R 0772 secrets

cd /srv/atremis
./atre pull
./atre update

command -v atre
echo SUCCEED
echo "PRESS ANY KEY TO RESTART OR CTRL+C TO ABORT"
read -n1 -r && sudo systemctl restart
